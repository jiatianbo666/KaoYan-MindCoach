# 考研心理辅导系统 - 部署和使用指南

## 🚀 快速部署

### 新用户（第一次运行）

```bash
# 1. 克隆代码
git clone <repository-url>
cd kaoyan-mindcoach

# 2. 安装后端依赖
cd backend
pip install -r requirements.txt

# 3. 启动后端
python run_server.py
# 首次启动会自动创建数据库 ✅

# 4. 安装前端依赖（新终端）
cd frontend
npm install

# 5. 启动前端
npm run serve

# 6. 访问
# 前端：http://localhost:8080
# 后端：http://localhost:8000
# API 文档：http://localhost:8000/docs
```

---

### 从旧版本升级

如果你已经有旧版本的数据库：

```bash
# 1. 停止后端服务

# 2. 备份数据库（可选）
cp backend/kaoyan_mindcoach.db backend/kaoyan_mindcoach.db.backup

# 3. 运行数据库迁移
python backend/migrate_add_stress_score.py

# 4. 按提示操作，确认迁移

# 5. 重启后端
cd backend
python run_server.py
```

---

## 🎨 DDL 紧张分数功能

### 7档颜色系统

| 分数 | 颜色 | 含义 |
|-----|------|------|
| 0-14 | 🔵 蓝色 | 很轻松 |
| 15-29 | 🔷 青色 | 轻松 |
| 30-44 | 🟢 绿色 | 进度良好 |
| 45-59 | 🟡 黄色 | 需要关注 |
| 60-74 | 🟠 橙色 | 较紧张 |
| 75-89 | 🔴 红色 | 很紧张 |
| 90-100 | 🟤 褐色 | 极度紧急！ |

### 使用方法

1. **在日历上点击某个日期**（这个日期就是 DDL）
2. **填写任务内容**
3. **设置当前进度**（0-100%）
4. **保存**
5. 日期方块会自动填充对应的紧张分数颜色

### 计算逻辑

```
紧张分数 = f(剩余天数, 当前进度)

考虑因素：
- 距离 DDL 越近 → 分数越高
- 当前进度越低 → 分数越高
- 最后 7 天时间权重增加到 70%
```

---

## 📊 数据库说明

### 使用的表

- `users` - 用户信息
- `mood_entries` - 情绪记录
- `task_entries` - 任务列表
- `calendar_notes` - 日历备注（包含 DDL 和紧张分数）
- `sleep_entries` - 睡眠记录

### 重要字段（calendar_notes）

- `note_date` - 标注日期
- `note_text` - 任务内容
- `progress` - 当前进度 (0-100)
- `ddl_date` - DDL 截止日期
- `stress_score` - 紧张分数 (0-100)

---

## 🔧 故障排查

### 问题 1：后端启动报错 "no such column: ddl_date"

**原因：** 数据库缺少新字段

**解决：**
```bash
python backend/migrate_add_stress_score.py
```

### 问题 2：前端没有显示紧张分数

**检查：**
1. 是否填写了任务内容？
2. 进度是否为 100%？（100% 时分数为 0）
3. 浏览器控制台是否有错误？
4. 尝试刷新页面（Ctrl+F5）

### 问题 3：颜色显示不正确

**解决：**
1. 清除浏览器缓存
2. 强制刷新（Ctrl+F5）
3. 检查 `stressScoreHelper.js` 是否存在

---

## 📁 项目结构

```
kaoyan-mindcoach/
├── backend/
│   ├── app/
│   │   ├── models/          # 数据库模型
│   │   ├── routers/         # API 路由
│   │   ├── schemas/         # 数据验证
│   │   └── services/        # 业务逻辑
│   ├── migrate_add_stress_score.py  # 迁移脚本
│   └── run_server.py        # 启动文件
├── frontend/
│   └── src/
│       ├── components/
│       │   └── InteractiveCalendar.vue  # 日历组件
│       ├── utils/
│       │   └── stressScoreHelper.js     # 辅助函数
│       └── views/           # 页面视图
├── README.md                # 项目说明
├── 给其他开发者的说明.md     # 开发者指南
└── 部署和使用指南.md         # 本文件
```

---

## ✅ 功能清单

- [x] 用户注册/登录
- [x] 情绪记录
- [x] 任务管理
- [x] 学习日历
- [x] DDL 紧张分数（7档颜色）
- [x] 睡眠记录
- [x] 压力雷达
- [x] 心流训练
- [x] 情绪急救
- [x] 心灵绘画

---

## 📞 需要帮助？

1. 查看 `给其他开发者的说明.md`
2. 检查浏览器控制台（F12）
3. 查看后端日志输出
4. 访问 API 文档：http://localhost:8000/docs

---

**祝你考研顺利！** 🎓✨
